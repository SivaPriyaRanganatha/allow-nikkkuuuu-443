<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Operation: Secure The Heart</title>
  <style>
    :root{
      --bg:#05070b;
      --panel:rgba(8,12,18,.82);
      --border:rgba(0,255,157,.22);
      --text:#b8ffd9;
      --dim:rgba(184,255,217,.72);
      --green:#00ff9d;
      --yellow:#ffd86b;
      --red:#ff5c7a;
      --blue:#7dd3fc;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      padding:16px;
      display:grid;
      place-items:center;
      background:
        radial-gradient(1200px 700px at 50% -10%, rgba(0,255,157,.13), transparent 60%),
        radial-gradient(900px 500px at 85% 5%, rgba(255,216,107,.08), transparent 60%),
        radial-gradient(900px 500px at 10% 10%, rgba(125,211,252,.06), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    .wrap{width:min(1040px, 100%)}
    .bar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:14px;
      margin-bottom:10px;
    }
    .dots{display:flex; gap:6px; align-items:center}
    .dot{width:10px;height:10px;border-radius:99px}
    .dot.r{background:var(--red)} .dot.y{background:var(--yellow)} .dot.g{background:var(--green)}
    .title{font-size:12px; opacity:.9}
    .badge{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color:var(--dim)}
    .grid{display:grid; grid-template-columns: 1.3fr .7fr; gap:10px}
    @media(max-width:920px){ .grid{grid-template-columns:1fr} }

    .panelBox{
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:18px;
      overflow:hidden;
    }
    .head{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      color:var(--dim);
      font-size:12px;
    }
    .screen{
      height:min(66vh,620px);
      padding:14px 14px 6px;
      overflow:auto;
      scroll-behavior:smooth;
      line-height:1.55;
      font-size:14px;
      white-space:pre-wrap;
    }
    .line{margin:0 0 6px 0}
    .dim{color:var(--dim)}
    .ok{color:var(--green)}
    .warn{color:var(--yellow)}
    .bad{color:var(--red)}
    .info{color:var(--blue)}
    .cmd{color:var(--text)}
    .kbd{
      display:inline-block;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(0,255,157,.25);
      background:rgba(0,0,0,.25);
      color:var(--text);
      font-size:12px;
    }

    .inputbar{
      display:flex; gap:10px; padding:10px 12px;
      border-top:1px solid var(--border);
      background:rgba(0,0,0,.25);
    }
    input{
      flex:1;
      border:1px solid var(--border);
      background:rgba(0,0,0,.30);
      color:var(--green);
      padding:12px 12px;
      border-radius:12px;
      font-size:14px;
      outline:none;
    }
    input::placeholder{color:rgba(0,255,157,.35)}
    button{
      border:1px solid var(--border);
      background:rgba(0,0,0,.28);
      color:var(--green);
      padding:12px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      font-size:14px;
      touch-action:manipulation;
      user-select:none;
    }
    button:hover{background:rgba(0,255,157,.10)}
    .side{
      border:1px solid var(--border);
      background:var(--panel);
      border-radius:18px;
      padding:12px;
    }
    .side h3{
      margin:0 0 10px;
      font-size:12px;
      color:var(--dim);
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .cmds{display:flex; flex-wrap:wrap; gap:10px}
    .chip{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      color:var(--text);
      font-size:13px;
      cursor:pointer;
    }
    .chip:active{transform:translateY(1px)}
    .actions{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .hintBtn{
      background:rgba(125,211,252,.10);
      border:1px solid rgba(125,211,252,.25);
      color:rgba(199,241,255,.95);
    }
    .hintBox{
      display:none;
      margin-top:10px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(125,211,252,.22);
      background:rgba(125,211,252,.08);
      color:rgba(199,241,255,.95);
      font-size:12px;
      line-height:1.45;
    }

    /* --- Ticket / Mail Modal --- */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.65);
      display:flex; align-items:center; justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal{
      width:min(640px, 100%);
      border:1px solid rgba(0,255,157,.25);
      border-radius:18px;
      background:rgba(8,12,18,.92);
      box-shadow:0 25px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 14px;
      border-bottom:1px solid rgba(0,255,157,.18);
      color:var(--dim);
      font-size:12px;
    }
    .mailTag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,216,107,.25);
      background:rgba(255,216,107,.08);
      color:rgba(255,216,107,.95);
      font-weight:800;
      font-size:12px;
    }
    .modalBody{padding:14px}
    .modalTitle{
      font-size:18px;
      color:var(--text);
      margin:0 0 6px 0;
      font-weight:900;
      letter-spacing:.01em;
    }
    .modalText{
      margin:0;
      color:rgba(184,255,217,.78);
      font-size:13px;
      line-height:1.55;
    }
    .kv{
      margin-top:12px;
      border:1px solid rgba(0,255,157,.18);
      background:rgba(0,0,0,.25);
      border-radius:14px;
      padding:10px;
      font-size:13px;
      color:rgba(184,255,217,.82);
      line-height:1.5;
    }
    .kv b{color:var(--text)}
    .modalActions{
      display:flex; gap:10px; flex-wrap:wrap;
      padding:12px 14px;
      border-top:1px solid rgba(0,255,157,.18);
      background:rgba(0,0,0,.22);
      position:relative;
      min-height:64px;
    }
    .yesBtn{
      background:rgba(0,255,157,.16);
      border:1px solid rgba(0,255,157,.35);
      color:var(--green);
    }
    .noWrap{position:relative; width:190px; height:44px}
    .noBtn{
      position:absolute; left:0; top:0; width:100%;
      background:rgba(255,92,122,.10);
      border:1px solid rgba(255,92,122,.45);
      color:rgba(255,92,122,.95);
      transition:transform .12s ease;
    }
    .tiny{font-size:12px; color:rgba(184,255,217,.55)}
    @media (max-width:480px){
      .screen{font-size:13px}
      button,input{font-size:15px}
      .noWrap{width:160px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div style="display:flex; gap:10px; align-items:center">
        <div class="dots"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span></div>
        <div class="title">Weston-NOC ‚Ä¢ Operation Console</div>
      </div>
      <div class="badge">Mission: <b>SECURE THE HEART</b></div>
    </div>

    <div class="grid">
      <div class="panelBox">
        <div class="head">
          <div>ssh nikkkuuuu@core-infra</div>
          <div class="dim" id="deviceLabel">WAITING ‚Ä¢ Ticket assignment required‚Ä¶</div>
        </div>

        <div class="screen" id="screen"></div>

        <div class="inputbar">
          <input id="cmdInput" placeholder="(Assign the ticket first) ..." autocomplete="off" disabled />
          <button id="runBtn" disabled>Run</button>
        </div>
      </div>

      <div class="side">
        <h3>Quick commands</h3>
        <div class="cmds" id="quickCmds"></div>

        <div class="actions">
          <button class="hintBtn" id="hintToggle">üõ∞Ô∏è Hints</button>
        </div>
        <div class="hintBox" id="hintBox"></div>

        <div style="margin-top:10px" class="tiny">
          Tip: Commands unlock hop-by-hop after you take the ticket.
        </div>
      </div>
    </div>
  </div>

  <!-- Mail/Ticket pop-up -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalHead">
        <div class="mailTag">üì© NEW INCIDENT EMAIL</div>
        <div class="dim">Priority: <b class="warn">P1</b></div>
      </div>
      <div class="modalBody">
        <h2 class="modalTitle">Incident: Traffic not reachable (Nikkkuuuu ‚Üí Siva)</h2>
        <p class="modalText">
          A critical encrypted transmission is failing. Love packets on <b>TCP/443</b> are being dropped somewhere between the
          access layer and the tunnel gateway.
        </p>

        <div class="kv">
          <div><b>Incident ID:</b> VAL-0214</div>
          <div><b>Source:</b> Nikkkuuuu</div>
          <div><b>Destination:</b> Siva</div>
          <div><b>Impact:</b> Heartbeat latency rising ‚Ä¢ Emotional SLA breached</div>
          <div><b>Path:</b> Switch ‚Üí Firewall ‚Üí ISE ‚Üí VPN ‚Üí Delivery</div>
        </div>

        <p class="modalText" style="margin-top:12px">
          Assign this ticket to <b>your name</b> to begin troubleshooting.
        </p>
      </div>

      <div class="modalActions">
        <button class="yesBtn" id="assignYes">‚úÖ Yes, assign to me</button>

        <div class="noWrap">
          <button class="noBtn" id="assignNo">‚ùå No</button>
        </div>

        <div class="tiny" id="noCounter" style="margin-left:auto; align-self:center;"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  const screen = document.getElementById('screen');
  const input = document.getElementById('cmdInput');
  const runBtn = document.getElementById('runBtn');
  const quickCmds = document.getElementById('quickCmds');
  const deviceLabel = document.getElementById('deviceLabel');

  const overlay = document.getElementById('overlay');
  const assignYes = document.getElementById('assignYes');
  const assignNo = document.getElementById('assignNo');
  const noCounter = document.getElementById('noCounter');

  const hintToggle = document.getElementById('hintToggle');
  const hintBox = document.getElementById('hintBox');

  const st = {
    ticketAssigned:false,
    enabled:false,
    phase:"intro", // intro->switch->firewall->ise->vpn->delivered
    fixedVlan:false,
    fixedFw:false,
    fixedIse:false,
    fixedVpn:false,
    noMoves:0,
    hintVisible:false,
    currentHint:""
  };

  function setDevice(name){ deviceLabel.textContent = name; }

  function p(text, cls="line"){
    const el = document.createElement('p');
    el.className = `line ${cls}`;
    el.textContent = text;
    screen.appendChild(el);
    screen.scrollTop = screen.scrollHeight;
  }

  function currentPrompt(){
    if (st.phase === "switch") return "SW-CORE-01#";
    if (st.phase === "firewall") return "FW-EDGE-01#";
    if (st.phase === "ise") return "ISE-PSN-01#";
    if (st.phase === "vpn") return "VPN-GW-01#";
    if (st.phase === "delivered") return "CHANGE-MGR#";
    return "CLASSIFIED#";
  }

  function promptLine(cmd){ p(`${currentPrompt()} ${cmd}`, "cmd"); }

  function normalize(s){ return (s||"").trim().toLowerCase().replace(/\s+/g,' '); }

  function clearQuick(){ quickCmds.innerHTML=""; }
  function addChip(label, cmd){
    const b = document.createElement('div');
    b.className="chip";
    b.textContent=label;
    b.addEventListener('click', () => run(cmd));
    quickCmds.appendChild(b);
  }

  // HINTS: only show if user clicks the button
  function setHint(message){
    st.currentHint = message || "";
    if (!st.hintVisible) return;
    hintBox.textContent = st.currentHint ? ("üõ∞Ô∏è Intel: " + st.currentHint) : "";
    hintBox.style.display = st.currentHint ? "block" : "none";
  }
  function toggleHints(){
    st.hintVisible = !st.hintVisible;
    if (st.hintVisible && st.currentHint){
      hintBox.textContent = "üõ∞Ô∏è Intel: " + st.currentHint;
      hintBox.style.display = "block";
    } else {
      hintBox.style.display = "none";
      hintBox.textContent = "";
    }
  }
  hintToggle.addEventListener('click', toggleHints);

  function refreshQuick(){
    clearQuick();

    // Before ticket assignment: nothing
    if (!st.ticketAssigned){
      addChip("Read email", "help");
      return;
    }

    // After ticket, before enable
    if (!st.enabled){
      addChip("enable", "enable");
      addChip("show mission", "show mission");
      return;
    }

    // Progressive commands (not all at once)
    if (st.phase === "switch"){
      addChip("show interface status", "show interface status");
      addChip("show vlan brief", "show vlan brief");
      if (!st.fixedVlan) addChip("fix vlan", "conf t ; interface Gi1/0/24 ; switchport access vlan 214 ; end ; wr mem");
      addChip("next ‚Üí firewall", "next");
      return;
    }
    if (st.phase === "firewall"){
      addChip("show access-list", "show access-list");
      addChip("packet-tracer", "packet-tracer input inside tcp NIKK 51432 SIVA 443");
      if (!st.fixedFw) addChip("fix acl allow 443", "fix acl allow 443");
      addChip("next ‚Üí ISE", "next");
      return;
    }
    if (st.phase === "ise"){
      addChip("show live logs", "show live logs");
      addChip("show auth status", "show authentication status");
      if (!st.fixedIse) addChip("fix policy (permit)", "fix ise");
      addChip("next ‚Üí VPN", "next");
      return;
    }
    if (st.phase === "vpn"){
      addChip("show crypto ikev2 sa", "show crypto ikev2 sa");
      addChip("ping SIVA via tunnel", "ping siva source tunnel0");
      if (!st.fixedVpn) addChip("rekey / bring tunnel up", "fix vpn");
      addChip("deliver payload", "deliver");
      return;
    }
    if (st.phase === "delivered"){
      addChip("show packet-capture", "show packet-capture");
      addChip("replay ending", "replay");
      return;
    }
  }

  function cinematicIntro(){
    setDevice("WAITING ‚Ä¢ Ticket assignment required‚Ä¶");
    p("üåå OPERATION: SECURE THE HEART üåå", "info");
    p("An encrypted transmission attempts to cross the network.", "dim");
    p("Source: Nikkkuuuu  ‚Üí  Destination: Siva", "dim");
    p("Protocol: TCP/443", "dim");
    p("", "dim");
    p("But the traffic is not reachable.", "warn");
    p("A P1 incident has been raised.", "warn");
    p("", "dim");
    p("Action required: assign ticket to begin.", "ok");
    setHint("Click ‚Äú‚úÖ Yes, assign to me‚Äù in the email to start.");
    refreshQuick();
  }

  function movePhase(newPhase){
    st.phase = newPhase;

    if (newPhase === "switch"){
      setDevice("SW-CORE-01 ‚Ä¢ Access Layer");
      p("", "dim");
      p("=== Hop 1/4: SWITCH ===", "info");
      p("Goal: get Nikkkuuuu traffic out of QUARANTINE and into VALENTINE VLAN.", "dim");
      setHint("Try `show interface status` then fix VLAN if needed.");
    }
    if (newPhase === "firewall"){
      setDevice("FW-EDGE-01 ‚Ä¢ Perimeter Firewall");
      p("", "dim");
      p("=== Hop 2/4: FIREWALL ===", "info");
      p("Goal: allow TCP/443 from Nikkkuuuu ‚Üí Siva.", "dim");
      setHint("Use `packet-tracer` or `show access-list` to find the DROP.");
    }
    if (newPhase === "ise"){
      setDevice("ISE-PSN-01 ‚Ä¢ Policy Enforcement");
      p("", "dim");
      p("=== Hop 3/4: ISE ===", "info");
      p("Goal: AUTHORIZED (no ACCESS_REJECT).", "dim");
      setHint("Run `show live logs` then apply `fix ise`.");
    }
    if (newPhase === "vpn"){
      setDevice("VPN-GW-01 ‚Ä¢ Tunnel Gateway");
      p("", "dim");
      p("=== Hop 4/4: VPN ===", "info");
      p("Goal: bring tunnel UP and pass packets.", "dim");
      setHint("Check `show crypto ikev2 sa`, then run `fix vpn`.");
    }
    if (newPhase === "delivered"){
      setDevice("CHANGE-MGR ‚Ä¢ Payload Delivery");
      setHint("Mission complete. üñ§");
    }
    refreshQuick();
  }

  // RUN COMMANDS
  function run(raw){
    if (!st.ticketAssigned) return;
    const cmd = (raw||input.value||"").trim();
    if (!cmd) return;
    input.value = "";

    const parts = cmd.split(";").map(s=>s.trim()).filter(Boolean);
    (async () => {
      for (const part of parts) await execOne(part);
      refreshQuick();
    })();
  }

  async function execOne(cmd){
    const c = normalize(cmd);

    if (c === "help"){
      promptLine(cmd);
      p("A P1 incident email is waiting. Assign the ticket to proceed.", "dim");
      return;
    }

    if (!st.ticketAssigned){
      promptLine(cmd);
      p("Blocked: ticket not assigned.", "warn");
      return;
    }

    // Before enable
    if (!st.enabled){
      if (c === "enable"){
        promptLine(cmd);
        p("Entering privileged mode‚Ä¶", "dim");
        p("Access granted: role=NetworkSecurity | clearance=LOVE-PRIME", "ok");
        st.enabled = true;
        movePhase("switch");
        return;
      }
      if (c === "show mission"){
        promptLine(cmd);
        p("Mission: Restore TCP/443 reachability from Nikkkuuuu ‚Üí Siva.", "dim");
        p("Path: Switch ‚Üí Firewall ‚Üí ISE ‚Üí VPN ‚Üí Delivery", "dim");
        return;
      }
      promptLine(cmd);
      p("Access denied. Type: enable", "warn");
      setHint("Type `enable` (or tap it on the right).");
      return;
    }

    // SWITCH
    if (st.phase === "switch"){
      if (c === "show interface status"){
        promptLine(cmd);
        p("Port      Name               Status       Vlan       Duplex Speed Type", "dim");
        p("Gi1/0/24  NIKK-CLIENT         connected    999        a-full a-100 10/100/1000-TX", st.fixedVlan ? "ok" : "warn");
        if (!st.fixedVlan){
          p("‚ö†Ô∏è VLAN mismatch: expected 214 (VALENTINE). found 999 (QUARANTINE).", "warn");
          setHint("Run `fix vlan` (quick command) to move Gi1/0/24 to VLAN 214.");
        } else {
          p("‚úÖ VLAN 214 verified. Switching path is clean.", "ok");
        }
        return;
      }
      if (c === "show vlan brief"){
        promptLine(cmd);
        p("VLAN Name                             Status    Ports", "dim");
        p("214  VALENTINE                         active", "ok");
        p("999  QUARANTINE                        active    Gi1/0/24", st.fixedVlan ? "dim" : "warn");
        if (!st.fixedVlan) setHint("Move Gi1/0/24 off QUARANTINE into VALENTINE VLAN 214.");
        return;
      }
      if (c.startsWith("conf t") || c.includes("switchport access vlan 214") || c.includes("wr mem")){
        promptLine(cmd);
        if (!st.fixedVlan){
          p("Applying change‚Ä¶", "dim");
          p("Gi1/0/24 moved: VLAN 999 ‚Üí VLAN 214", "ok");
          p("write memory‚Ä¶ done", "ok");
          st.fixedVlan = true;
          p("‚úÖ Hop cleared. Forwarding to perimeter is now possible.", "ok");
        } else {
          p("No changes required.", "dim");
        }
        return;
      }
      if (c === "next"){
        promptLine(cmd);
        if (!st.fixedVlan){
          p("Blocked: traffic still quarantined. Fix VLAN first.", "warn");
          setHint("Check `show interface status` then run `fix vlan`.");
        } else {
          p("Forwarding traffic ‚Üí Firewall‚Ä¶", "ok");
          movePhase("firewall");
        }
        return;
      }
      promptLine(cmd);
      p("Unknown command.", "warn");
      setHint("Try `show interface status`.");
      return;
    }

    // FIREWALL
    if (st.phase === "firewall"){
      if (c === "show access-list"){
        promptLine(cmd);
        p("access-list OUTSIDE-IN; 3 elements", "dim");
        p("1: deny tcp any host SIVA eq 443  (hitcnt=42)", st.fixedFw ? "dim" : "bad");
        p("2: permit tcp host NIKK any eq 22 (hitcnt=3)", "dim");
        p("3: deny ip any any (hitcnt=999)", "dim");
        if (!st.fixedFw){
          p("‚ùå tcp/443 to Siva is being dropped.", "bad");
          setHint("Run `fix acl allow 443`.");
        } else {
          p("‚úÖ Policy clean. 443 permitted.", "ok");
        }
        return;
      }
      if (c.startsWith("packet-tracer")){
        promptLine(cmd);
        if (!st.fixedFw){
          p("Phase: 1 ROUTE-LOOKUP ‚Ä¶ ALLOW", "dim");
          p("Phase: 2 ACCESS-LIST  ‚Ä¶ DROP", "bad");
          p("Result: DROP (OUTSIDE-IN line 1)", "bad");
          setHint("Fix ACL to permit NIKK ‚Üí SIVA on TCP/443.");
        } else {
          p("Phase: 1 ROUTE-LOOKUP ‚Ä¶ ALLOW", "dim");
          p("Phase: 2 ACCESS-LIST  ‚Ä¶ ALLOW", "ok");
          p("Result: ALLOW", "ok");
        }
        return;
      }
      if (c === "fix acl allow 443" || c === "fix acl"){
        promptLine(cmd);
        p("Applying policy update‚Ä¶", "dim");
        p("Removed: deny tcp any host SIVA eq 443", "ok");
        p("Added:   permit tcp host NIKK host SIVA eq 443", "ok");
        p("Commit complete.", "ok");
        st.fixedFw = true;
        p("‚úÖ Hop cleared. Traffic may proceed to policy engine.", "ok");
        return;
      }
      if (c === "next"){
        promptLine(cmd);
        if (!st.fixedFw){
          p("Blocked: firewall still dropping TCP/443.", "warn");
          setHint("Run `show access-list` then `fix acl allow 443`.");
        } else {
          p("Forwarding traffic ‚Üí ISE‚Ä¶", "ok");
          movePhase("ise");
        }
        return;
      }
      promptLine(cmd);
      p("Unknown command.", "warn");
      setHint("Try `show access-list` or `packet-tracer`.");
      return;
    }

    // ISE
    if (st.phase === "ise"){
      if (c === "show live logs"){
        promptLine(cmd);
        if (!st.fixedIse){
          p("Event 5400 Authentication failed", "bad");
          p("Failure Reason: 15039 Rejected per authorization profile", "bad");
          p("Authorization Profile: ACCESS_REJECT", "bad");
          p("User: nikkkuuuu", "warn");
          setHint("Apply `fix ise` to map user to VALENTINE_PERMIT.");
        } else {
          p("Event 22037 Authentication succeeded", "ok");
          p("Authorization Profile: VALENTINE_PERMIT", "ok");
          p("User: nikkkuuuu", "ok");
        }
        return;
      }
      if (c === "show authentication status"){
        promptLine(cmd);
        if (!st.fixedIse){
          p("User: nikkkuuuu", "dim");
          p("Status: REJECTED (ACCESS_REJECT)", "bad");
          setHint("Run `fix ise`.");
        } else {
          p("User: nikkkuuuu", "dim");
          p("Status: AUTHORIZED", "ok");
          p("Profile: VALENTINE_PERMIT", "ok");
        }
        return;
      }
      if (c === "fix ise"){
        promptLine(cmd);
        p("Updating authorization policy‚Ä¶", "dim");
        p("Rule updated: nikkkuuuu ‚Üí VALENTINE_PERMIT", "ok");
        p("Policy push complete.", "ok");
        st.fixedIse = true;
        p("‚úÖ Hop cleared. Proceed to tunnel gateway.", "ok");
        return;
      }
      if (c === "next"){
        promptLine(cmd);
        if (!st.fixedIse){
          p("Blocked: ISE still rejecting.", "warn");
          setHint("Run `show live logs` then `fix ise`.");
        } else {
          p("Forwarding traffic ‚Üí VPN Gateway‚Ä¶", "ok");
          movePhase("vpn");
        }
        return;
      }
      promptLine(cmd);
      p("Unknown command.", "warn");
      setHint("Try `show live logs`.");
      return;
    }

    // VPN
    if (st.phase === "vpn"){
      if (c === "show crypto ikev2 sa"){
        promptLine(cmd);
        if (!st.fixedVpn){
          p("Session-id: 0, Status: DOWN", "bad");
          p("Reason: key exchange pending", "warn");
          setHint("Run `fix vpn` to bring the tunnel UP.");
        } else {
          p("Session-id: 7, Status: UP-ACTIVE", "ok");
          p("Encryption: AES-FOREVER  Integrity: HMAC-üíö", "ok");
        }
        return;
      }
      if (c === "ping siva source tunnel0"){
        promptLine(cmd);
        if (!st.fixedVpn){
          p(".....", "warn");
          p("Success rate is 0 percent (timeout)", "bad");
          setHint("Tunnel is down‚Äîrun `fix vpn`, then ping again.");
        } else {
          p("!!!!!", "ok");
          p("Success rate is 100 percent (5/5)", "ok");
        }
        return;
      }
      if (c === "fix vpn"){
        promptLine(cmd);
        p("Initiating rekey‚Ä¶", "dim");
        p("Generating: LOVE-KEY (2048-bit)", "ok");
        p("IKEv2 negotiation‚Ä¶ complete", "ok");
        p("Tunnel0: UP", "ok");
        st.fixedVpn = true;
        p("‚úÖ Tunnel established. Ready to deliver payload.", "ok");
        return;
      }
      if (c === "deliver"){
        promptLine(cmd);
        if (!st.fixedVpn){
          p("Blocked: tunnel still DOWN.", "warn");
          setHint("Run `show crypto ikev2 sa` then `fix vpn`.");
        } else {
          st.phase = "delivered";
          setDevice("CHANGE-MGR ‚Ä¢ Payload Delivery");
          p("", "dim");
          p("=== DELIVERY ===", "info");
          p("Capturing traffic on TCP/443 ‚Ä¶", "dim");
          p("Packets in flight‚Ä¶", "dim");
          p("‚úÖ Traffic delivered to Siva successfully.", "ok");
          p("", "dim");
          p("Packet Capture:", "dim");
          p("SRC: NIKK   DST: SIVA   PROTO: TCP/443   FLAG: PSH,ACK", "ok");
          p("PAYLOAD:", "dim");
          p("\"I love you, my forever Valentine, Nikkkuuuu üíñ\"", "ok");
          p("", "dim");
          p("Status: Production love tunnel established. Failover: NEVER.", "info");
          refreshQuick();
          setHint("Optional: run `show packet-capture`.");
        }
        return;
      }
      promptLine(cmd);
      p("Unknown command.", "warn");
      setHint("Try `show crypto ikev2 sa`.");
      return;
    }

    // Delivered
    if (st.phase === "delivered"){
      if (c === "show packet-capture"){
        promptLine(cmd);
        p("PCAP Summary:", "dim");
        p("Frames: 14   Drops: 0   Latency: 0ms (when she smiles)", "ok");
        p("Final Payload: \"I love you, my forever Valentine, Nikkkuuuu üíñ\"", "ok");
        return;
      }
      if (c === "replay ending" || c === "replay"){
        promptLine(cmd);
        p("Replaying ending‚Ä¶", "dim");
        p("‚úÖ Traffic delivered to Siva successfully.", "ok");
        p("\"I love you, my forever Valentine, Nikkkuuuu üíñ\"", "ok");
        return;
      }
      promptLine(cmd);
      p("Mission complete.", "dim");
      return;
    }
  }

  // Ticket assignment YES/NO behavior
  function moveNo(){
    st.noMoves++;
    noCounter.textContent = `Nice try üòè (${st.noMoves}/5)`;
    const wrap = assignNo.parentElement;
    const w = wrap.clientWidth;
    const h = wrap.clientHeight;
    const dx = Math.floor((Math.random() * (w - 44)) - (w/2 - 22));
    const dy = Math.floor((Math.random() * (h - 34)) - (h/2 - 17));
    assignNo.style.transform = `translate(${dx}px, ${dy}px)`;

    if (st.noMoves === 1) {
      // little sass in the terminal too
      p("Incoming email opened‚Ä¶", "dim");
      p("Attempted action: DENY ticket assignment", "warn");
      p("Response: Nice try. You can‚Äôt escape this mission üòå", "warn");
    }

    if (st.noMoves >= 5){
      // disappear no button
      assignNo.style.display = "none";
      noCounter.textContent = "No option removed ‚úÖ";
    }
  }

  // Desktop + mobile
  assignNo.addEventListener('mouseenter', moveNo);
  assignNo.addEventListener('touchstart', (e) => { e.preventDefault(); moveNo(); }, {passive:false});
  assignNo.addEventListener('click', (e) => { e.preventDefault(); moveNo(); });

  assignYes.addEventListener('click', () => {
    overlay.style.display = "none";
    st.ticketAssigned = true;
    input.disabled = false;
    runBtn.disabled = false;

    setDevice("CLASSIFIED ‚Ä¢ Ticket assigned to Nikkkuuuu");
    p("", "dim");
    p("‚úÖ Ticket assigned to: Nikkkuuuu", "ok");
    p("Status: IN PROGRESS", "info");
    p("Objective: Restore reachability (TCP/443) from Nikkkuuuu ‚Üí Siva", "dim");
    p("", "dim");
    p("Type: enable", "ok");
    setHint("Start by typing `enable` (or tap it on the right).");
    refreshQuick();
  });

  // Run events
  runBtn.addEventListener('click', () => run());
  input.addEventListener('keydown', (e) => { if (e.key === "Enter") run(); });

  // Boot
  cinematicIntro();
})();
</script>
</body>
</html>
