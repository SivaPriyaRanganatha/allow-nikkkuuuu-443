<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yuki.co ‚Ä¢ Incident Console</title>
  <style>
    :root{
      --bg1:#08101f;
      --bg2:#091a2f;
      --glass: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.16);
      --shadow: 0 18px 70px rgba(0,0,0,.48);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --green:#00ff9d;
      --yellow:#ffd86b;
      --red:#ff5c7a;
      --blue:#7dd3fc;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 70% 10%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(1100px 700px at 20% 20%, rgba(0,255,157,.14), transparent 60%),
        radial-gradient(900px 700px at 50% 90%, rgba(255,92,122,.14), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    /* Hearts wallpaper + big watermark */
    .wallpaper{
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 50% 20%, rgba(255,92,122,.10), transparent 60%),
        radial-gradient(900px 520px at 35% 75%, rgba(255,216,107,.07), transparent 60%),
        radial-gradient(900px 520px at 75% 70%, rgba(125,211,252,.06), transparent 60%);
    }
    .wallpaper::before{
      content:"";
      position:absolute; inset:-160px;
      background:
        radial-gradient(circle at 20% 25%, rgba(255,92,122,.22) 0 2px, transparent 3px) 0 0/90px 90px,
        radial-gradient(circle at 65% 70%, rgba(255,216,107,.18) 0 2px, transparent 3px) 0 0/110px 110px;
      opacity:.9;
      animation: drift 12s ease-in-out infinite alternate;
    }
    @keyframes drift{
      from{ transform: translate3d(-14px,-10px,0) }
      to{ transform: translate3d(14px,10px,0) }
    }
    .watermark{
      position:fixed; inset:0;
      pointer-events:none;
      display:grid;
      place-items:center;
      opacity:.12;
      font-weight:900;
      letter-spacing:.06em;
      font-size: clamp(56px, 10vw, 140px);
      text-transform:uppercase;
      color:rgba(255,255,255,.86);
      text-shadow: 0 18px 60px rgba(0,0,0,.35);
      mix-blend-mode: overlay;
    }
    .watermark small{
      display:block;
      font-size: clamp(14px, 2vw, 22px);
      letter-spacing:.22em;
      opacity:.8;
      margin-top:10px;
      text-align:center;
    }

    /* Desktop chrome */
    .desktop{ position:relative; height:100%; padding:18px; }
    .brand{
      position:absolute; left:18px; top:14px;
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      border-radius:14px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      user-select:none;
      z-index:3;
    }
    .brand .logo{
      width:34px; height:34px; border-radius:12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(0,255,157,.95), transparent 70%),
        radial-gradient(20px 20px at 70% 70%, rgba(125,211,252,.85), transparent 70%),
        radial-gradient(18px 18px at 80% 30%, rgba(255,216,107,.75), transparent 70%),
        rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand .name{ font-weight:900; letter-spacing:.02em; line-height:1.05; }
    .brand .sub{
      font-size:12px; color:var(--muted);
      letter-spacing:.06em; text-transform:uppercase;
    }

    .taskbar{
      position:absolute; left:50%; bottom:14px;
      transform:translateX(-50%);
      width:min(760px, calc(100% - 28px));
      height:56px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding:10px 14px;
      z-index:3;
    }
    .tbIcon{
      width:36px; height:36px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      display:grid; place-items:center;
      user-select:none;
    }
    .tbIcon svg{opacity:.92}
    .tbSep{width:1px; height:28px; background: rgba(255,255,255,.14); margin:0 4px}

    /* Outlook toast */
    .toast{
      position:absolute;
      right:18px;
      bottom:86px;
      width:min(420px, calc(100% - 36px));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      padding:12px;
      display:none;
      cursor:pointer;
      transform: translateY(24px);
      opacity:0;
      animation: toastIn .55s ease forwards;
      z-index:4;
    }
    @keyframes toastIn{ to{ transform:translateY(0); opacity:1; } }
    .toastRow{display:flex; gap:10px; align-items:flex-start}
    .toastIcon{
      width:38px; height:38px; border-radius:14px;
      background: rgba(125,211,252,.16);
      border:1px solid rgba(125,211,252,.25);
      display:grid; place-items:center;
      flex:0 0 auto;
    }
    .toastTitle{ font-weight:900; margin:0; font-size:14px; line-height:1.2; }
    .toastMeta{ margin:2px 0 0 0; color:var(--muted); font-size:12px; line-height:1.35; }
    .toastHint{
      margin:8px 0 0 0;
      color:rgba(255,255,255,.80);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      display:inline-block;
    }

    /* Outlook mail window */
    .overlay{
      position:absolute; inset:0;
      background: rgba(0,0,0,.35);
      display:none;
      z-index:20;
    }
    .mailWin{
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:min(920px, calc(100% - 28px));
      height:min(560px, calc(100% - 140px));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .winHead{
      height:46px;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 12px;
      border-bottom:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
    }
    .winDots{display:flex; gap:8px; align-items:center}
    .winDot{width:10px;height:10px;border-radius:50%}
    .winDot.r{background:var(--red)} .winDot.y{background:var(--yellow)} .winDot.g{background:var(--green)}
    .winTitle{
      font-weight:800;
      font-size:13px;
      color:rgba(255,255,255,.85);
      display:flex; align-items:center; gap:8px;
    }
    .pill{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,216,107,.25);
      background: rgba(255,216,107,.10);
      color: rgba(255,216,107,.95);
      font-weight:900;
      letter-spacing:.05em;
      text-transform:uppercase;
    }
    .closeBtn{
      width:36px; height:30px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color:rgba(255,255,255,.85);
      cursor:pointer;
    }
    .closeBtn:hover{background: rgba(255,92,122,.18); border-color: rgba(255,92,122,.28)}
    .mailBody{
      display:grid;
      grid-template-columns: 260px 1fr;
      height: calc(100% - 46px);
    }
    @media(max-width:860px){ .mailBody{grid-template-columns: 1fr} .leftPane{display:none} }
    .leftPane{
      border-right:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
      padding:10px;
    }
    .folder{
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      margin-bottom:10px;
      color:rgba(255,255,255,.78);
      font-size:13px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .folder b{color:rgba(255,255,255,.92)}
    .mailPane{ padding:14px; overflow:auto; }
    .mailHdr{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .mailSubj{ margin:0; font-weight:900; letter-spacing:.01em; font-size:18px; line-height:1.2; }
    .mailFrom{ margin:6px 0 0 0; color:var(--muted); font-size:13px; line-height:1.4; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color:rgba(255,255,255,.82);
      font-size:12px;
      white-space:nowrap;
    }
    .kv{
      margin-top:10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding:12px;
      font-size:13px;
      color:rgba(255,255,255,.80);
      line-height:1.55;
    }
    .kv b{color:rgba(255,255,255,.92)}
    .assignRow{
      margin-top:14px;
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center;
      position:relative;
      min-height:86px;
    }
    .btn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:rgba(255,255,255,.90);
      cursor:pointer;
      font-weight:900;
      letter-spacing:.01em;
    }
    .btn:hover{background: rgba(255,255,255,.12)}
    .btnYes{
      border-color: rgba(0,255,157,.30);
      background: rgba(0,255,157,.14);
      color: rgba(0,255,157,.95);
    }

    /* NO teleports across the whole mail window area (hard to click) */
    .noBtn{
      position:absolute;
      left:340px;
      top: 14px;
      width:180px;
      border-color: rgba(255,92,122,.40);
      background: rgba(255,92,122,.10);
      color: rgba(255,92,122,.95);
      transition: transform .10s ease;
      z-index:5;
    }
    @media(max-width:860px){
      .noBtn{ left: 220px; }
    }
    .attempts{ margin-left:auto; color:rgba(255,255,255,.65); font-size:12px; }

    /* Terminal window */
    .termWin{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:min(980px, calc(100% - 28px));
      height:min(640px, calc(100% - 130px));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      display:none;
      z-index:15;
      overflow:hidden;
    }
    .termHead{
      height:46px;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 12px;
      border-bottom:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
    }
    .termHead .left{
      display:flex; align-items:center; gap:10px;
      color:rgba(255,255,255,.80);
      font-size:13px;
      font-weight:800;
    }
    .termHead .right{
      display:flex; align-items:center; gap:10px;
      color:rgba(255,255,255,.65);
      font-size:12px;
    }
    .hintBtn{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(125,211,252,.28);
      background: rgba(125,211,252,.10);
      color: rgba(199,241,255,.95);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .hintBtn:hover{background: rgba(125,211,252,.14)}
    .screen{
      padding:14px 14px 6px;
      overflow:auto;
      height: calc(100% - 64px);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size:14px;
      line-height:1.55;
      color: rgba(184,255,217,.92);
      white-space:pre-wrap;
    }
    .line{margin:0 0 6px 0}
    .tDim{color: rgba(184,255,217,.70)}
    .tOk{color: var(--green)}
    .tWarn{color: var(--yellow)}
    .tBad{color: var(--red)}
    .tInfo{color: var(--blue)}
    .tCmd{color: rgba(255,255,255,.92)}
    .inputBar{
      display:flex; gap:10px;
      align-items:center;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      height:64px;
    }
    .cmdInput{
      flex:1;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(184,255,217,.95);
      padding:12px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size:14px;
      outline:none;
    }
    .cmdInput::placeholder{color: rgba(184,255,217,.45)}
    .runBtn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(0,255,157,.28);
      background: rgba(0,255,157,.12);
      color: rgba(0,255,157,.95);
      cursor:pointer;
      font-weight:900;
      letter-spacing:.01em;
    }
    .runBtn:hover{background: rgba(0,255,157,.16)}
    .hintPanel{
      position:absolute;
      right:12px;
      top:58px;
      width:min(380px, calc(100% - 24px));
      border-radius:16px;
      border:1px solid rgba(125,211,252,.26);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding:12px;
      display:none;
      z-index:30;
    }
    .hintPanel h4{
      margin:0 0 6px 0;
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: rgba(199,241,255,.90);
    }
    .hintPanel p{
      margin:0;
      font-size:13px;
      color: rgba(199,241,255,.84);
      line-height:1.45;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    /* Cinematic ending */
    .ending{
      position:absolute; inset:0;
      display:none;
      z-index:50;
      overflow:hidden;
      background:
        radial-gradient(900px 520px at 55% 25%, rgba(255,92,122,.22), transparent 60%),
        radial-gradient(900px 520px at 35% 80%, rgba(255,216,107,.12), transparent 60%),
        radial-gradient(900px 520px at 75% 70%, rgba(125,211,252,.10), transparent 60%),
        #000;
    }
    .heartsFloat{
      position:absolute; inset:-20px;
      pointer-events:none;
      opacity:.85;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,92,122,.35) 0 2px, transparent 3px) 0 0/70px 70px,
        radial-gradient(circle at 82% 42%, rgba(255,216,107,.20) 0 2px, transparent 3px) 0 0/90px 90px,
        radial-gradient(circle at 40% 76%, rgba(255,255,255,.12) 0 2px, transparent 3px) 0 0/110px 110px;
      animation: drift2 10s ease-in-out infinite alternate;
      filter: blur(.1px);
    }
    @keyframes drift2{
      from{ transform: translate3d(-10px, -8px, 0) }
      to{ transform: translate3d(10px, 8px, 0) }
    }

    .sil{
      position:absolute;
      left:50%; top:58%;
      transform: translate(-50%,-50%);
      width:min(980px, 95vw);
      opacity:0;
      animation: silIn 1.2s ease .6s forwards;
      filter: drop-shadow(0 18px 50px rgba(0,0,0,.55));
    }
    @keyframes silIn{ to{opacity:1} }

    .runGroup{ animation: runAcross 4.0s ease-in-out 1.0s forwards; }
    @keyframes runAcross{
      0%{ transform: translateX(-380px) }
      100%{ transform: translateX(120px) }
    }

    .kiss{ opacity:0; animation: kissIn 1.0s ease 4.2s forwards; }
    @keyframes kissIn{ to{opacity:1} }

    .finalText{
      position:absolute;
      left:50%;
      bottom:10%;
      transform:translateX(-50%);
      color: rgba(255,255,255,.92);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size:16px;
      letter-spacing:.02em;
      text-align:center;
      opacity:0;
      animation: textIn 1.1s ease 3.0s forwards;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
    }
    @keyframes textIn{ to{opacity:1} }
  </style>
</head>
<body>
  <div class="wallpaper"></div>
  <div class="watermark">
    YUKI.CO
    <small>Secure Love Delivery ‚Ä¢ NOC</small>
  </div>

  <div class="desktop">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="name">Yuki.co</div>
        <div class="sub">Network Operations</div>
      </div>
    </div>

    <div class="taskbar" aria-hidden="true">
      <div class="tbIcon" title="Start">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M3 3h8v8H3V3Zm10 0h8v8h-8V3ZM3 13h8v8H3v-8Zm10 0h8v8h-8v-8Z" stroke="rgba(255,255,255,.86)" stroke-width="1.7"/>
        </svg>
      </div>
      <div class="tbIcon" title="Search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(255,255,255,.86)" stroke-width="1.7"/>
          <path d="M16.8 16.8 21 21" stroke="rgba(255,255,255,.86)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="tbIcon" title="Outlook">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M4 7.5h12.5v11H4v-11Z" stroke="rgba(255,255,255,.86)" stroke-width="1.7"/>
          <path d="M16.5 9 20 7.5v11l-3.5-1.5V9Z" stroke="rgba(255,255,255,.86)" stroke-width="1.7"/>
          <path d="M4 8l6.25 5L16.5 8" stroke="rgba(255,255,255,.86)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="tbSep"></div>
      <div class="tbIcon" title="Terminal">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16v12H4V6Z" stroke="rgba(255,255,255,.86)" stroke-width="1.7"/>
          <path d="M7 9l3 3-3 3" stroke="rgba(255,255,255,.86)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 15h5" stroke="rgba(255,255,255,.86)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" role="button" tabindex="0" aria-label="New incident email notification">
      <div class="toastRow">
        <div class="toastIcon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M4 7h16v10H4V7Z" stroke="rgba(255,255,255,.90)" stroke-width="1.7"/>
            <path d="M4 8l8 6 8-6" stroke="rgba(255,255,255,.90)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div>
          <p class="toastTitle">Outlook ‚Ä¢ New incident</p>
          <p class="toastMeta">
            <b>P1:</b> Traffic from <b>Nikkkuuuu</b> to <b>Siva</b> is <b>NOT REACHABLE</b> (TCP/443) ‚Äî click to open.
          </p>
          <span class="toastHint">Click to open email (enables sound)</span>
        </div>
      </div>
    </div>

    <!-- Outlook overlay -->
    <div class="overlay" id="overlay" aria-hidden="true">
      <div class="mailWin" role="dialog" aria-modal="true" aria-label="Outlook email">
        <div class="winHead">
          <div class="winDots" aria-hidden="true">
            <span class="winDot r"></span><span class="winDot y"></span><span class="winDot g"></span>
          </div>
          <div class="winTitle">
            Outlook ‚Äî Incident Mail <span class="pill">P1</span>
          </div>
          <button class="closeBtn" id="closeMail" title="Close">‚úï</button>
        </div>

        <div class="mailBody">
          <div class="leftPane">
            <div class="folder"><span>Inbox</span><b>1</b></div>
            <div class="folder"><span>Incidents</span><b>1</b></div>
            <div class="folder"><span>Sent</span><b>0</b></div>
            <div class="folder"><span>Drafts</span><b>0</b></div>
            <div class="folder"><span>Archive</span><b>0</b></div>
          </div>

          <div class="mailPane">
            <div class="mailHdr">
              <div>
                <h2 class="mailSubj">INCIDENT: Traffic not reachable (Nikkkuuuu ‚Üí Siva)</h2>
                <p class="mailFrom">
                  From: <b>noc@yuki.co</b><br/>
                  To: <b>Nikkkuuuu</b><br/>
                  Time: <b id="mailTime"></b>
                </p>
              </div>
              <div class="chip">Impact: Heartbeat latency rising ‚Ä¢ SLA breach risk</div>
            </div>

            <div class="kv">
              <div><b>Incident ID:</b> VAL-0214</div>
              <div><b>Source:</b> 10.214.0.10 (NIKK)</div>
              <div><b>Destination:</b> 10.13.0.7 (SIVA)</div>
              <div><b>Service:</b> TCP/443</div>
              <div><b>Suspected path:</b> Switch ‚Üí Firewall ‚Üí ISE ‚Üí VPN</div>
              <div style="margin-top:8px"><b>Request:</b> Assign this ticket to your name to start troubleshooting.</div>
            </div>

            <div class="assignRow" id="assignArea">
              <button class="btn btnYes" id="assignYes">‚úÖ Yes, assign to me</button>
              <button class="btn noBtn" id="assignNo">‚ùå No</button>
              <div class="attempts" id="attempts"></div>
            </div>

            <div class="kv" style="margin-top:12px; color:rgba(255,255,255,.78)">
              <b>Note:</b> ‚ÄúNo‚Äù will attempt to escape. After 5 tries it disappears.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Terminal -->
    <div class="termWin" id="termWin" role="dialog" aria-modal="true" aria-label="Incident terminal">
      <div class="termHead">
        <div class="left">
          <span style="display:inline-flex; gap:8px; align-items:center">
            <span style="width:10px;height:10px;border-radius:50%;background:var(--green);display:inline-block"></span>
            Yuki.co Incident Console
          </span>
          <span style="color:rgba(255,255,255,.65); font-weight:700" id="devLabel">‚Ä¢ WAITING</span>
        </div>
        <div class="right">
          <button class="hintBtn" id="hintBtn">Hints</button>
          <span id="soundStatus">üîá Sound</span>
        </div>
      </div>

      <div class="hintPanel" id="hintPanel">
        <h4>Next hint</h4>
        <p id="hintText">‚Äî</p>
      </div>

      <div class="screen" id="screen"></div>
      <div class="inputBar">
        <input class="cmdInput" id="cmdInput" placeholder="Type a command‚Ä¶ (press Enter)" autocomplete="off" />
        <button class="runBtn" id="runBtn">Run</button>
      </div>
    </div>

    <!-- Ending -->
    <div class="ending" id="ending" aria-hidden="true">
      <div class="heartsFloat"></div>

      <svg class="sil" viewBox="0 0 1200 420" xmlns="http://www.w3.org/2000/svg" fill="none">
        <!-- ground -->
        <path d="M70 340 C 260 320, 380 360, 560 340 C 740 320, 900 370, 1130 340"
              stroke="rgba(255,255,255,.18)" stroke-width="6" stroke-linecap="round"/>

        <!-- couple (right) -->
        <g class="kiss" opacity="0.96">
          <!-- woman -->
          <circle cx="940" cy="200" r="20" fill="rgba(255,255,255,.92)"/>
          <path d="M928 220 C 922 262, 915 290, 900 330 C 890 356, 918 366, 930 338
                   C 942 312, 948 286, 950 262
                   C 954 286, 962 312, 974 338
                   C 986 366, 1014 356, 1004 330
                   C 989 290, 982 262, 976 220 Z"
                fill="rgba(255,255,255,.92)"/>
          <!-- man standing (already there waiting) -->
          <circle cx="1015" cy="196" r="20" fill="rgba(255,255,255,.92)"/>
          <path d="M1002 216 C 997 258, 990 288, 976 328 C 966 354, 994 364, 1006 336
                   C 1018 310, 1024 284, 1026 260
                   C 1030 284, 1038 310, 1050 336
                   C 1062 364, 1090 354, 1080 328
                   C 1066 288, 1059 258, 1054 216 Z"
                fill="rgba(255,255,255,.92)"/>
          <!-- hug/kiss lines -->
          <path d="M972 238 C 990 228, 1002 222, 1016 220" stroke="rgba(255,255,255,.74)" stroke-width="10" stroke-linecap="round"/>
          <path d="M1004 238 C 990 230, 980 226, 966 224" stroke="rgba(255,255,255,.74)" stroke-width="10" stroke-linecap="round"/>
          <path d="M984 204 C 996 196, 1006 194, 1016 196" stroke="rgba(255,255,255,.55)" stroke-width="6" stroke-linecap="round"/>
          <!-- tiny heart above kiss -->
          <path d="M985 160
                   C 985 150, 997 150, 997 160
                   C 997 170, 985 176, 985 176
                   C 985 176, 973 170, 973 160
                   C 973 150, 985 150, 985 160 Z"
                fill="rgba(255,92,122,.55)"/>
        </g>

        <!-- runner + dog (left group) -->
        <g class="runGroup" opacity="0.96">
          <!-- leash -->
          <path d="M360 292 C 330 305, 300 314, 265 322" stroke="rgba(255,255,255,.30)" stroke-width="5" stroke-linecap="round"/>

          <!-- dog silhouette (more dog-like) -->
          <g transform="translate(210,285)">
            <!-- body -->
            <ellipse cx="40" cy="40" rx="42" ry="24" fill="rgba(255,255,255,.92)"/>
            <!-- head -->
            <circle cx="88" cy="34" r="16" fill="rgba(255,255,255,.92)"/>
            <!-- ear -->
            <path d="M92 20 C 84 10, 72 12, 76 26 C 80 34, 88 30, 92 20 Z" fill="rgba(255,255,255,.92)"/>
            <!-- legs -->
            <path d="M22 60 L18 80" stroke="rgba(255,255,255,.92)" stroke-width="10" stroke-linecap="round"/>
            <path d="M44 60 L40 82" stroke="rgba(255,255,255,.92)" stroke-width="10" stroke-linecap="round"/>
            <path d="M60 58 L58 82" stroke="rgba(255,255,255,.92)" stroke-width="10" stroke-linecap="round"/>
            <path d="M78 56 L76 80" stroke="rgba(255,255,255,.92)" stroke-width="10" stroke-linecap="round"/>
            <!-- tail -->
            <path d="M5 34 C -12 24, -12 10, 2 10" stroke="rgba(255,255,255,.92)" stroke-width="10" stroke-linecap="round"/>
          </g>

          <!-- running man -->
          <g transform="translate(340,160)">
            <circle cx="70" cy="40" r="20" fill="rgba(255,255,255,.92)"/>
            <!-- torso -->
            <path d="M56 60 C 52 110, 44 140, 28 190
                     C 20 212, 46 222, 56 198
                     C 68 170, 74 138, 78 112
                     C 86 142, 96 170, 110 196
                     C 124 222, 150 212, 140 190
                     C 122 140, 112 110, 106 60 Z"
                  fill="rgba(255,255,255,.92)"/>
            <!-- arms (running pose) -->
            <path d="M54 96 C 24 100, 14 110, 8 122" stroke="rgba(255,255,255,.78)" stroke-width="12" stroke-linecap="round"/>
            <path d="M104 98 C 132 110, 144 124, 156 142" stroke="rgba(255,255,255,.78)" stroke-width="12" stroke-linecap="round"/>
            <!-- legs (running) -->
            <path d="M66 190 C 48 220, 36 238, 22 260" stroke="rgba(255,255,255,.88)" stroke-width="14" stroke-linecap="round"/>
            <path d="M94 190 C 112 216, 134 232, 162 250" stroke="rgba(255,255,255,.88)" stroke-width="14" stroke-linecap="round"/>
          </g>
        </g>
      </svg>

      <div class="finalText">Payload delivered: ‚ÄúI love you, my forever Valentine, Nikkkuuuu.‚Äù üíñ</div>
    </div>
  </div>

  <script>
    (() => {
      // ---- Sound (works after first user gesture) ----
      let audioCtx = null;
      let soundEnabled = false;

      function ensureAudio(){
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === "suspended") audioCtx.resume();
        soundEnabled = true;
        document.getElementById("soundStatus").textContent = "üîä Sound";
      }

      function beep(freq=740, dur=0.08, type="sine", gain=0.05){
        if (!soundEnabled) return;
        const ctx = audioCtx;
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = type;
        o.frequency.value = freq;
        g.gain.value = gain;
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + dur);
      }
      function notifSound(){ beep(880,0.07,"sine",0.05); setTimeout(()=>beep(660,0.09,"sine",0.05),90); }
      function errorSound(){ beep(220,0.10,"square",0.04); setTimeout(()=>beep(180,0.12,"square",0.04),110); }
      function okSound(){ beep(523.25,0.06,"sine",0.05); setTimeout(()=>beep(783.99,0.09,"sine",0.05),80); }

      // ---- UI refs ----
      const toast = document.getElementById("toast");
      const overlay = document.getElementById("overlay");
      const closeMail = document.getElementById("closeMail");
      const assignYes = document.getElementById("assignYes");
      const assignNo = document.getElementById("assignNo");
      const attemptsEl = document.getElementById("attempts");
      const mailTime = document.getElementById("mailTime");
      const assignArea = document.getElementById("assignArea");

      const termWin = document.getElementById("termWin");
      const screen = document.getElementById("screen");
      const cmdInput = document.getElementById("cmdInput");
      const runBtn = document.getElementById("runBtn");
      const devLabel = document.getElementById("devLabel");

      const hintBtn = document.getElementById("hintBtn");
      const hintPanel = document.getElementById("hintPanel");
      const hintText = document.getElementById("hintText");

      const ending = document.getElementById("ending");

      // ---- State ----
      const st = {
        ticketAssigned:false,
        noTries:0,
        phase:"pre", // pre, sw, fw, ise, vpn, done
        sw: { sawStatus:false, fixedVlan:false },
        fw: { sawAcl:false, ranPT:false, fixedAcl:false, appliedGroup:false, wrote:false },
        ise:{ sawApp:false, sawLogs:false },
        vpn:{ sawIke:false, cleared:false },
      };

      // ---- Terminal helpers ----
      function tLine(text, cls="tDim"){
        const p = document.createElement("p");
        p.className = `line ${cls}`;
        p.textContent = text;
        screen.appendChild(p);
        screen.scrollTop = screen.scrollHeight;
      }
      function prompt(){
        if (st.phase === "sw") return "SW-CORE-01#";
        if (st.phase === "fw") return "FW-EDGE-01#";
        if (st.phase === "ise") return "ise/admin#";
        if (st.phase === "vpn") return "VPN-GW-01#";
        if (st.phase === "done") return "CHANGE-MGR#";
        return "YUKI-NOC#";
      }
      function cmdEcho(cmd){ tLine(`${prompt()} ${cmd}`, "tCmd"); }
      function setDev(label){ devLabel.textContent = "‚Ä¢ " + label; }

      // ---- Hints toggle (only on click) ----
      let hintOpen = false;
      hintBtn.addEventListener("click", () => {
        hintOpen = !hintOpen;
        hintPanel.style.display = hintOpen ? "block" : "none";
      });
      function setHint(msg){ hintText.textContent = msg; }

      // ---- Boot toast ----
      function boot(){
        mailTime.textContent = new Date().toLocaleString();
        setTimeout(() => { toast.style.display = "block"; }, 900);
      }

      function openMail(){
        ensureAudio();
        notifSound();
        overlay.style.display = "block";
        overlay.setAttribute("aria-hidden", "false");
      }
      toast.addEventListener("click", openMail);
      toast.addEventListener("keydown", (e)=>{ if(e.key==="Enter") openMail(); });
      closeMail.addEventListener("click", () => {
        overlay.style.display = "none";
        overlay.setAttribute("aria-hidden", "true");
      });

      // ---- NO teleport (far, hard to click) ----
      function teleportNo(){
        ensureAudio();
        st.noTries++;
        errorSound();

        const area = assignArea.getBoundingClientRect();
        const btn = assignNo.getBoundingClientRect();

        // random position inside assignArea, keep within bounds
        const pad = 10;
        const maxX = Math.max(pad, area.width - btn.width - pad);
        const maxY = Math.max(pad, area.height - btn.height - pad);

        const x = pad + Math.random() * maxX;
        const y = pad + Math.random() * maxY;

        assignNo.style.left = x + "px";
        assignNo.style.top = y + "px";
        assignNo.style.transform = `rotate(${(Math.random()*10-5).toFixed(1)}deg)`;

        attemptsEl.textContent = `Nice try. You can‚Äôt get me. (${st.noTries}/5)`;

        if (st.noTries >= 5){
          assignNo.style.display = "none";
          attemptsEl.textContent = "No option removed ‚úÖ Now click YES.";
          okSound();
        }
      }
      assignNo.addEventListener("mouseenter", teleportNo);
      assignNo.addEventListener("click", (e)=>{ e.preventDefault(); teleportNo(); });
      assignNo.addEventListener("touchstart", (e)=>{ e.preventDefault(); teleportNo(); }, {passive:false});

      // ---- Assign YES starts terminal ----
      assignYes.addEventListener("click", () => {
        ensureAudio();
        okSound();

        st.ticketAssigned = true;
        overlay.style.display = "none";
        overlay.setAttribute("aria-hidden", "true");
        termWin.style.display = "block";

        setDev("INCIDENT VAL-0214 ‚Ä¢ Trace started");
        tLine("üåå OPERATION: SECURE THE HEART üåå", "tInfo");
        tLine("P1: Traffic NOT REACHABLE (10.214.0.10 ‚Üí 10.13.0.7) TCP/443", "tWarn");
        tLine("Path: Switch ‚Üí Firewall ‚Üí ISE ‚Üí VPN ‚Üí Delivery", "tDim");
        tLine("", "tDim");
        tLine("Type: enable", "tOk");
        setHint("enable");
        cmdInput.focus();
      });

      // ---- Command engine (standard commands only; next/deliver for story) ----
      function norm(s){ return (s||"").trim().toLowerCase().replace(/\s+/g," "); }

      function showRejected(){
        errorSound();
        tLine("% Invalid input detected at '^' marker.", "tBad");
        setHint(nextHint());
      }

      function nextHint(){
        if (st.phase === "pre") return "enable";
        if (st.phase === "sw"){
          if (!st.sw.sawStatus) return "show interface status";
          if (!st.sw.fixedVlan) return "conf t ; interface gi1/0/24 ; switchport access vlan 214 ; end ; wr mem";
          return "next";
        }
        if (st.phase === "fw"){
          if (!st.fw.ranPT) return "packet-tracer input inside tcp 10.214.0.10 51432 10.13.0.7 443 detailed";
          if (!st.fw.fixedAcl) return "conf t ; access-list OUTSIDE-IN extended permit tcp host 10.214.0.10 host 10.13.0.7 eq 443 ; end";
          if (!st.fw.appliedGroup) return "conf t ; access-group OUTSIDE-IN in interface outside ; end";
          if (!st.fw.wrote) return "write memory";
          return "next";
        }
        if (st.phase === "ise"){
          if (!st.ise.sawApp) return "show application status ise";
          if (!st.ise.sawLogs) return "show logging application ise-auth.log tail";
          return "next";
        }
        if (st.phase === "vpn"){
          if (!st.vpn.sawIke) return "show crypto ikev2 sa";
          if (!st.vpn.cleared) return "clear crypto ikev2 sa";
          return "deliver";
        }
        return "‚Äî";
      }

      async function exec(cmdRaw){
        const cmd = cmdRaw.trim();
        const c = norm(cmdRaw);
        if (!cmd) return;

        cmdEcho(cmd);
        ensureAudio();

        // PRE
        if (st.phase === "pre"){
          if (c === "enable"){
            okSound();
            tLine("Password: ********", "tDim");
            tLine("Entering privileged mode‚Ä¶", "tDim");
            tLine("Access granted: role=NetworkSecurity | clearance=LOVE-PRIME", "tOk");
            st.phase = "sw";
            setDev("SW-CORE-01 ‚Ä¢ Access Layer");
            tLine("", "tDim");
            tLine("=== HOP 1/4: SWITCH ===", "tInfo");
            tLine("Symptom: client traffic appears quarantined on access port.", "tWarn");
            setHint(nextHint());
            return;
          }
          errorSound();
          tLine("% Access denied. Type: enable", "tWarn");
          setHint(nextHint());
          return;
        }

        // SWITCH (Cisco IOS)
        if (st.phase === "sw"){
          if (c === "show interface status"){
            st.sw.sawStatus = true;
            tLine("Port      Name               Status       Vlan       Duplex Speed Type", "tDim");
            if (!st.sw.fixedVlan){
              tLine("Gi1/0/24  NIKK-CLIENT         connected    999        a-full a-100 10/100/1000-TX", "tWarn");
              tLine("% VLAN mismatch: expected 214 (VALENTINE), found 999 (QUARANTINE).", "tBad");
              errorSound();
            } else {
              tLine("Gi1/0/24  NIKK-CLIENT         connected    214        a-full a-100 10/100/1000-TX", "tOk");
              okSound();
            }
            setHint(nextHint());
            return;
          }

          if (c === "show interfaces gi1/0/24 switchport"){
            tLine("Name: Gi1/0/24", "tDim");
            tLine("Administrative Mode: static access", "tDim");
            tLine("Operational Mode: static access", "tDim");
            tLine("Access Mode VLAN: " + (st.sw.fixedVlan ? "214 (VALENTINE)" : "999 (QUARANTINE)"), st.sw.fixedVlan ? "tOk" : "tBad");
            if (!st.sw.fixedVlan) errorSound(); else okSound();
            setHint(nextHint());
            return;
          }

          if (c === "show vlan brief"){
            tLine("VLAN Name                             Status    Ports", "tDim");
            tLine("214  VALENTINE                         active", "tOk");
            tLine("999  QUARANTINE                        active    " + (st.sw.fixedVlan ? "" : "Gi1/0/24"), st.sw.fixedVlan ? "tDim" : "tWarn");
            setHint(nextHint());
            return;
          }

          if (c === "show mac address-table interface gi1/0/24"){
            tLine("          Mac Address Table", "tDim");
            tLine("-------------------------------------------", "tDim");
            tLine("Vlan    Mac Address       Type        Ports", "tDim");
            tLine((st.sw.fixedVlan ? "214" : "999") + "     aaaa.bbbb.cccc    DYNAMIC     Gi1/0/24", st.sw.fixedVlan ? "tOk" : "tWarn");
            setHint(nextHint());
            return;
          }

          // accept config chain that includes switchport access vlan 214 (standard)
          if (c.includes("switchport access vlan 214")){
            if (!st.sw.fixedVlan){
              tLine("Enter configuration commands, one per line. End with CNTL/Z.", "tDim");
              tLine("SW-CORE-01(config)# interface Gi1/0/24", "tDim");
              tLine("SW-CORE-01(config-if)# switchport mode access", "tDim");
              tLine("SW-CORE-01(config-if)# switchport access vlan 214", "tOk");
              tLine("SW-CORE-01(config-if)# end", "tDim");
              tLine("SW-CORE-01# write memory", "tDim");
              tLine("Building configuration... [OK]", "tOk");
              st.sw.fixedVlan = true;
              okSound();
            } else {
              tLine("% No changes required.", "tDim");
            }
            setHint(nextHint());
            return;
          }

          if (c === "wr mem" || c === "write memory"){
            tLine("Building configuration... [OK]", "tOk");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c === "next"){
            if (!st.sw.fixedVlan){
              errorSound();
              tLine("% BLOCKED: VLAN still incorrect on Gi1/0/24.", "tWarn");
              setHint(nextHint());
              return;
            }
            okSound();
            st.phase = "fw";
            setDev("FW-EDGE-01 ‚Ä¢ Perimeter Firewall");
            tLine("", "tDim");
            tLine("=== HOP 2/4: FIREWALL ===", "tInfo");
            tLine("Symptom: TCP/443 dropped at policy enforcement.", "tWarn");
            setHint(nextHint());
            return;
          }

          showRejected();
          return;
        }

        // FIREWALL (ASA)
        if (st.phase === "fw"){
          if (c === "show access-list"){
            st.fw.sawAcl = true;
            tLine("access-list OUTSIDE-IN; 4 elements", "tDim");
            if (!st.fw.fixedAcl){
              tLine("deny tcp any host 10.13.0.7 eq 443 (hitcnt=57)", "tBad");
              tLine("permit icmp any any (hitcnt=19)", "tDim");
              tLine("deny ip any any (hitcnt=1200)", "tDim");
              errorSound();
            } else {
              tLine("permit tcp host 10.214.0.10 host 10.13.0.7 eq 443 (hitcnt=14)", "tOk");
              tLine("deny ip any any (hitcnt=1200)", "tDim");
              okSound();
            }
            setHint(nextHint());
            return;
          }

          if (c === "show run access-group"){
            tLine("access-group OUTSIDE-IN in interface outside", st.fw.appliedGroup ? "tOk" : "tWarn");
            setHint(nextHint());
            return;
          }

          if (c === "show run access-list"){
            tLine("access-list OUTSIDE-IN extended " + (st.fw.fixedAcl
              ? "permit tcp host 10.214.0.10 host 10.13.0.7 eq https"
              : "deny tcp any host 10.13.0.7 eq https"), st.fw.fixedAcl ? "tOk" : "tBad");
            setHint(nextHint());
            return;
          }

          if (c.startsWith("packet-tracer input inside tcp 10.214.0.10 51432 10.13.0.7 443")){
            st.fw.ranPT = true;
            if (!st.fw.fixedAcl){
              tLine("Phase: 1  ROUTE-LOOKUP  Result: ALLOW", "tDim");
              tLine("Phase: 2  ACCESS-LIST   Result: DROP", "tBad");
              tLine("Drop-reason: (acl-drop) OUTSIDE-IN deny tcp any host 10.13.0.7 eq 443", "tBad");
              errorSound();
            } else {
              tLine("Phase: 1  ROUTE-LOOKUP  Result: ALLOW", "tDim");
              tLine("Phase: 2  ACCESS-LIST   Result: ALLOW", "tOk");
              tLine("Result: ALLOW", "tOk");
              okSound();
            }
            setHint(nextHint());
            return;
          }

          if (c.includes("access-list outside-in extended permit tcp host 10.214.0.10 host 10.13.0.7 eq 443")){
            st.fw.fixedAcl = true;
            tLine("Applied: OUTSIDE-IN permit tcp host 10.214.0.10 host 10.13.0.7 eq 443", "tOk");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c.includes("access-group outside-in in interface outside")){
            st.fw.appliedGroup = true;
            tLine("access-group OUTSIDE-IN in interface outside", "tOk");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c === "write memory" || c === "wr mem"){
            st.fw.wrote = true;
            tLine("Building configuration... [OK]", "tOk");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c === "next"){
            if (!(st.fw.ranPT && st.fw.fixedAcl && st.fw.appliedGroup && st.fw.wrote)){
              errorSound();
              tLine("% BLOCKED: firewall steps incomplete (run packet-tracer, add permit, apply access-group, write memory).", "tWarn");
              setHint(nextHint());
              return;
            }
            okSound();
            st.phase = "ise";
            setDev("ISE-PSN-01 ‚Ä¢ Cisco ISE (ADE-OS)");
            tLine("", "tDim");
            tLine("=== HOP 3/4: ISE ===", "tInfo");
            tLine("Symptom: policy/auth may be impacting the flow.", "tWarn");
            setHint(nextHint());
            return;
          }

          showRejected();
          return;
        }

        // ISE (ADE-OS style commands)
        if (st.phase === "ise"){
          if (c === "show application status ise"){
            st.ise.sawApp = true;
            tLine("ISE PROCESS NAME                       STATE", "tDim");
            tLine("Database Listener                      running", "tOk");
            tLine("Application Server                     running", "tOk");
            tLine("Policy Service                         running", "tOk");
            tLine("Profiler Service                       running", "tDim");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c === "show logging application ise-auth.log tail"){
            st.ise.sawLogs = true;
            tLine("tail: ise-auth.log", "tDim");
            tLine("... AuthZ: ACCESS_REJECT (guest quarantine) for user nikkkuuuu", "tBad");
            tLine("... Next: policy updated by change owner (GUI) ‚Äî pending re-auth", "tWarn");
            errorSound();
            setHint("next");
            return;
          }

          if (c === "show logging application ise-psc.log tail"){
            tLine("tail: ise-psc.log", "tDim");
            tLine("... RADIUS: Access-Reject sent to NAD (previous attempt)", "tWarn");
            setHint(nextHint());
            return;
          }

          if (c === "show logging system ade.log tail"){
            tLine("tail: ade.log", "tDim");
            tLine("... System healthy. No disk or service faults.", "tOk");
            setHint(nextHint());
            return;
          }

          if (c === "show version"){
            tLine("Cisco Identity Services Engine (ISE) ‚Äî ADE-OS", "tDim");
            tLine("Version: 3.x (simulated)", "tDim");
            setHint(nextHint());
            return;
          }

          if (c === "show uptime"){
            tLine("System uptime: 23 days, 11 hours, 07 minutes", "tDim");
            setHint(nextHint());
            return;
          }

          if (c === "next"){
            if (!(st.ise.sawApp && st.ise.sawLogs)){
              errorSound();
              tLine("% BLOCKED: check ISE application status + auth logs first.", "tWarn");
              setHint(nextHint());
              return;
            }
            okSound();
            st.phase = "vpn";
            setDev("VPN-GW-01 ‚Ä¢ VPN Gateway");
            tLine("", "tDim");
            tLine("=== HOP 4/4: VPN ===", "tInfo");
            tLine("Symptom: IKE/IPsec state needs verification.", "tWarn");
            setHint(nextHint());
            return;
          }

          showRejected();
          return;
        }

        // VPN (Cisco/ASA-ish)
        if (st.phase === "vpn"){
          if (c === "show crypto ikev2 sa"){
            st.vpn.sawIke = true;
            tLine("IPv4 Crypto IKEv2  SA", "tDim");
            tLine("Tunnel-id Local               Remote              Status", "tDim");
            if (!st.vpn.cleared){
              tLine("0        10.0.0.1:500         10.0.0.2:500         DOWN", "tBad");
              tLine("% No active IKEv2 SAs. Clear & renegotiate.", "tWarn");
              errorSound();
            } else {
              tLine("7        10.0.0.1:500         10.0.0.2:500         UP-ACTIVE", "tOk");
              tLine("Encryption: AES-256  Integrity: SHA256  DPD: enabled", "tOk");
              okSound();
            }
            setHint(nextHint());
            return;
          }

          if (c === "show crypto ipsec sa"){
            tLine("pkts encaps: " + (st.vpn.cleared ? "18" : "0") + ", pkts decaps: " + (st.vpn.cleared ? "18" : "0"),
                  st.vpn.cleared ? "tOk" : "tBad");
            if (!st.vpn.cleared) { errorSound(); setHint(nextHint()); } else { okSound(); setHint(nextHint()); }
            return;
          }

          if (c === "clear crypto ikev2 sa"){
            st.vpn.cleared = true;
            tLine("Clearing IKEv2 SAs‚Ä¶", "tDim");
            tLine("Re-negotiation initiated.", "tOk");
            okSound();
            setHint(nextHint());
            return;
          }

          if (c === "deliver"){
            if (!(st.vpn.sawIke && st.vpn.cleared)){
              errorSound();
              tLine("% BLOCKED: verify IKEv2 SA and clear to renegotiate first.", "tWarn");
              setHint(nextHint());
              return;
            }

            st.phase = "done";
            setDev("CHANGE-MGR ‚Ä¢ Payload Delivery");
            okSound();
            tLine("", "tDim");
            tLine("=== DELIVERY ===", "tInfo");
            tLine("Capturing TCP/443‚Ä¶", "tDim");
            tLine("Frames: 18  Drops: 0  Latency: 0ms", "tOk");
            tLine("Payload delivered:", "tDim");
            tLine("‚ÄúI love you, my forever Valentine, Nikkkuuuu.‚Äù üíñ", "tOk");
            tLine("", "tDim");
            tLine("Mission complete.", "tOk");

            setTimeout(() => {
              termWin.style.display = "none";
              ending.style.display = "block";
              okSound();
            }, 1200);
            return;
          }

          if (c === "next"){
            errorSound();
            tLine("% NEXT not valid here. Use: deliver", "tWarn");
            setHint("deliver");
            return;
          }

          showRejected();
          return;
        }
      }

      function runFromUI(){
        const v = cmdInput.value;
        cmdInput.value = "";
        exec(v);
      }
      runBtn.addEventListener("click", runFromUI);
      cmdInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") runFromUI(); });

      boot();
    })();
  </script>
</body>
</html>
